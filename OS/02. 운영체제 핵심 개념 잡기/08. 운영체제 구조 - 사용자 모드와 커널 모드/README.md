# 운영체제 구조
## CPU Protection Rings
- CPU도 권한 모드라는 것을 가지고 있다.
    - 사용자 모드 (user mode)
    - 커널 모드 (kernel mode) : 특권 명령어 실행과 원하는 작업 수행을 위한
    자원 접근을 가능케 하는 모드

## kernel이란?
- OS kernel
- 사전
1. (견과류 ・ 씨앗의) 알맹이
2. (사상 ・ 주제의) 핵심

## Shell 이란?
- 사전
1. (달걀 견과류 등의 딱딱한)껍데기
2. 고둥 껍데기 모양의 것

## CPU Protection Rings
- 두 가지 모드
    - 사용자 모드 (user mode) : 응용 프로그램이 사용
    - 커널 모드 (kernel mode) : OS가 사용

## 응용 프로그램과 운영체제
- 우리가 만드는 프로그램은 맨 위에서 놀고 있다.<br>
응용프로그램<br>
    ^|<br>
    |v<br>
  API<br>
    ^ |<br>
    | v사용자 영역<br>
  시스템 호출 인터페이스------------------<br>
    | | |커널 영역<br>
메모리 디스크 네트워크  

## 시스템콜은 커널모드로 실행
- 커널 모드에서만 실행 가능한 기능들이 있음
- 커널 모드로 실행하려면, 반드시 시스템 콜을 사용해야 함(거쳐야 함)
- 시스템 콜은 운영체제 제공

## 사용자 모드와 커널모드
- 함부로 응용 프로그램이 전체 컴퓨터 시스템을 해치지 못함
- 주민등록등본은 꼭 동사무소 또는 민원24시 (정부 사이트)에서 특별한 신청서(시스템 콜)를 써야만 발급 -> 사용자 모드
  - 동사무소 직원분들은 특별한 권한을 가지고, 주민등록등본 출력 명령을 실행 -> 커널모드

### 응용프로그래머와 시스템 프로그래머
- 응용 프로그래머 : API를 가지고 사용자프로그램을 만드는 프로그래머
- 시스템 프로그래머 : 운영 체제 및 시스템 프로그램 (Shell, API, System call) / 하드웨어

### C언어 example1
1. 사용자 모드에서 프로그램 실행
2. open() 시스템 콜 호출
3. 커널 모드로 전환
4. open() 함수를 처리하는 sys_open() 커널 함수 호출
5. 파일 열기의 함수로 레벨 연산 수행
6. 사용자 모드로 전환
7. open() 함수 이후의 프로그램을 계속해서 실행

### C언어 Code example2
사용자 프로그램 - open() 함수 호출
```
#include <unistd.h>
main(){
  open()
}
```
^<br>
|<br>
v<br>
헤더 파일
```
unistd.h 파일
open 선언
```
^<br>
|<br>
v<br>
커널
```
테이블
open() -> sys_open()
```

## 정리
- 운영체제는 시스템 콜 제공
- 프로그래밍 언어별로 운영체제 기능을 활용하기 위해, 시스템 콜을 기반으로 API 제공
- 응용 프록그램은 운영체제 기능 필요 시, 해당 API를 사용해서 프로그램을 작성
- 응용 프로그램이 실행되서, 운영체제 기능이 필요한 API를 호출하면, 시스템 콜이 호출되서, 커널 모드로 변경되어
OS 내부에서 해당 명령이 실행되고 다시 응용 프로그램으로 돌아간다.

